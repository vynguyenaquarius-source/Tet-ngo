<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Happy New Year My Star üåü</title>
    <style>
        body { margin: 0; background-color: #000; overflow: hidden; font-family: Arial, sans-serif; touch-action: manipulation; }
        canvas { display: block; }
        #overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.98); display: flex; justify-content: center;
            align-items: center; z-index: 1000; color: white;
        }
        #startBtn {
            padding: 12px 35px; font-size: 0.9rem; background: transparent;
            color: #fff; border: 1px solid #fff; border-radius: 5px;
            cursor: pointer; letter-spacing: 2px;
        }
    </style>
</head>
<body>

    <div id="overlay">
        <button id="startBtn">CH·∫†M ƒê·ªÇ B·∫ÆT ƒê·∫¶U ‚ú®</button>
    </div>

    <audio id="bgMusic" loop playsinline>
        <source src="HPNY.mp3" type="audio/mpeg">
        <source src="hpny.mp3" type="audio/mpeg">
    </audio>

    <canvas id="canvas"></canvas>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d', { willReadFrequently: true });
        const music = document.getElementById('bgMusic');
        const startBtn = document.getElementById('startBtn');
        const overlay = document.getElementById('overlay');

        let particles = [];
        let textParticles = [];
        let fireworks = [];
        let stars = [];
        let buildings = [];
        let animationStep = 0; 
        let isFinalMessage = false;

        function resize() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            initBuildings();
        }
        window.addEventListener('resize', resize);

        class TextParticle {
            constructor(x, y, color) {
                this.destX = x; this.destY = y;
                this.x = Math.random() * canvas.width;
                this.y = Math.random() * canvas.height;
                this.vx = (Math.random() - 0.5) * 20;
                this.vy = (Math.random() - 0.5) * 20;
                this.acc = 0.07; 
                this.friction = 0.93;
                this.color = color;
            }
            update() {
                let dx = this.destX - this.x;
                let dy = this.destY - this.y;
                this.vx += dx * this.acc; this.vy += dy * this.acc;
                this.vx *= this.friction; this.vy *= this.friction;
                this.x += this.vx; this.y += this.vy;
            }
            draw() {
                ctx.fillStyle = this.color;
                ctx.fillRect(this.x, this.y, 1.8, 1.8);
            }
        }

        function createTextParticles(lines, color = "#FFFFFF") {
            const oldParticles = [...textParticles];
textParticles = [];
            
            const isMobile = window.innerWidth < 600;
            // TƒÉng c·ª° ch·ªØ l√™n v√¨ d√≤ng ƒë√£ ƒë∆∞·ª£c chia ng·∫Øn l·∫°i
            let fontSize = isMobile ? window.innerWidth / 10 : 55;
            
            ctx.font = `bold ${fontSize}px Arial`;
            let maxWidth = window.innerWidth * 0.85; 
            
            lines.forEach(line => {
                while(ctx.measureText(line).width > maxWidth && fontSize > 15) {
                    fontSize -= 1;
                    ctx.font = `bold ${fontSize}px Arial`;
                }
            });
            
            ctx.textAlign = "center";
            ctx.textBaseline = "middle";
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            lines.forEach((line, index) => {
                // TƒÉng kho·∫£ng c√°ch d√≤ng ƒë·ªÉ d·ªÖ ƒë·ªçc h∆°n
                const yOffset = (index - (lines.length - 1) / 2) * (fontSize * 1.7);
                ctx.fillText(line, canvas.width / 2, canvas.height / 2 + yOffset);
            });

            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            const data = imageData.data;

            // Qu√©t h·∫°t si√™u d√†y cho d√≤ng ch·ªØ cu·ªëi
            const gap = isFinalMessage ? 2 : 3;

            for (let y = 0; y < canvas.height; y += gap) {
                for (let x = 0; x < canvas.width; x += gap) {
                    if (data[(y * canvas.width + x) * 4 + 3] > 128) {
                        if (oldParticles.length > 0) {
                            let p = oldParticles.pop();
                            p.destX = x; p.destY = y; p.color = color;
                            textParticles.push(p);
                        } else {
                            textParticles.push(new TextParticle(x, y, color));
                        }
                    }
                }
            }
        }

        function initBuildings() {
            buildings = [];
            const spacing = window.innerWidth < 600 ? 55 : 85;
            for (let i = 0; i < window.innerWidth; i += spacing) {
                buildings.push({ x: i, w: spacing - 10, h: Math.random() * 80 + 60, windows: [] });
            }
            buildings.forEach(b => {
                for (let wy = canvas.height - b.h + 15; wy < canvas.height - 10; wy += 18) {
                    for (let wx = b.x + 10; wx < b.x + b.w - 5; wx += 12) {
                        b.windows.push({x: wx, y: wy, on: Math.random() > 0.4});
                    }
                }
            });
        }

        class Firework {
            constructor(x, isSpecial = false) {
                this.x = x || Math.random() * canvas.width;
                this.y = canvas.height;
                this.targetY = Math.random() * (canvas.height * 0.45);
                this.speed = 4.5;
                this.color = isSpecial ? "#ffd700" : `hsl(${Math.random() * 360}, 100%, 75%)`;
this.isSpecial = isSpecial;
                this.dead = false;
            }
            update() { this.y -= this.speed; if (this.y <= this.targetY) this.dead = true; }
            draw() {
                ctx.fillStyle = this.color;
                ctx.beginPath(); ctx.arc(this.x, this.y, 2, 0, Math.PI*2); ctx.fill();
            }
        }

        function createStarExplosion(x, y) {
            const points = 5;
            for (let i = 0; i < 180; i++) {
                let angle = (i / 180) * Math.PI * 2;
                let mod = (i / 180) * points;
                let s = Math.abs(Math.sin(mod * Math.PI));
                let speed = 2 + (1 - s) * 6; 
                particles.push({ x: x, y: y, vx: Math.cos(angle)*speed, vy: Math.sin(angle)*speed, alpha: 1, color: "#ffd700", gravity: 0.05 });
            }
        }

        function loop() {
            ctx.fillStyle = isFinalMessage ? 'rgba(0, 0, 0, 0.3)' : 'rgba(0, 0, 0, 0.2)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            stars.forEach(s => {
                ctx.fillStyle = `rgba(255,255,255,${Math.random()})`;
                ctx.fillRect(s.x, s.y, s.size, s.size);
            });

            if (animationStep >= 1) {
                textParticles.forEach(p => { p.update(); p.draw(); });
            } 
            
            if (animationStep === 2) {
                buildings.forEach(b => {
                    ctx.fillStyle = "#05050a"; ctx.fillRect(b.x, canvas.height - b.h, b.w, b.h);
                    b.windows.forEach(w => {
                        ctx.fillStyle = w.on ? "#ffd700" : "#101020";
                        if (Math.random() > 0.998) w.on = !w.on;
                        ctx.fillRect(w.x, w.y, 4, 7);
                    });
                });
                fireworks.forEach((fw, i) => {
                    fw.update(); fw.draw();
                    if (fw.dead) {
                        if (fw.isSpecial || Math.random() > 0.6) createStarExplosion(fw.x, fw.y);
                        else {
                            for(let j=0; j<60; j++) particles.push({
                                x: fw.x, y: fw.y, vx: Math.random()*7-3.5, vy: Math.random()*7-3.5, 
                                alpha: 1, color: fw.color, gravity: 0.08
                            });
                        }
                        fireworks.splice(i, 1);
                    }
                });
                particles.forEach((p, i) => {
                    p.x += p.vx; p.y += p.vy + p.gravity; p.alpha -= 0.015;
                    if (p.alpha <= 0) particles.splice(i, 1);
                    ctx.globalAlpha = p.alpha; ctx.fillStyle = p.color;
                    ctx.fillRect(p.x, p.y, 1.2, 1.2);
                });
                ctx.globalAlpha = 1;
            }
            requestAnimationFrame(loop);
        }

        resize();
for(let i=0; i<150; i++) stars.push({x: Math.random()*window.innerWidth, y: Math.random()*window.innerHeight, size: Math.random()*1.5});

        startBtn.onclick = () => {
            overlay.style.display = 'none';
            music.play().catch(() => {
                document.addEventListener('touchstart', () => music.play(), {once: true});
            });

            animationStep = 1;
            createTextParticles(["HAPPY NEW YEAR", "MY STAR "], "#FFFFFF");

            setTimeout(() => {
                animationStep = 2;
                isFinalMessage = true; 
                // CHIA NH·ªé D√íNG CH·ªÆ ƒê·ªÇ HI·ªÇN TH·ªä TO V√Ä R√ï TR√äN ƒêI·ªÜN THO·∫†I
                createTextParticles([
                    "Ng√¥i sao ∆°i,",
                    "m·ªôt nƒÉm m·ªõi",
                    "m·ªôt h√†nh tr√¨nh m·ªõi,",
                    "h√£y to·∫£ s√°ng",
                    "th·∫≠t r·ª±c r·ª° nh√©."
                ], "#FFFFFF"); 

                setInterval(() => { fireworks.push(new Firework()); }, 550); 
            }, 8000); 

            loop();
        };
    </script>
</body>

</html>

